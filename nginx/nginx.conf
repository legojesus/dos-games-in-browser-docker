worker_processes auto;

events {
    worker_connections 1024;
    multi_accept on;
}

http {

    # Upstream for aladdin
    upstream aladdin {
        server aladdin:8080;
    }

    # Upstream for chess
    upstream chess {
        server chess:8080;
    }

    # Upstream for doom
    upstream doom {
        server doom:8080;
    }

    # Upstream for doomii
    upstream doomii {
        server doomii:8080;
    }

    # Upstream for duke3d
    upstream duke3d {
        server duke3d:8080;
    }

    # Upstream for earthwormjim
    upstream earthwormjim {
        server earthwormjim:8080;
    }

    # Upstream for goldenaxe
    upstream goldenaxe {
        server goldenaxe:8080;
    }

    # Upstream for gta
    upstream gta {
        server gta:8080;
    }

    # Upstream for homm3 (VNC)
    upstream homm3_vnc {
        server homm3:8080;
    }

    # Upstream for homm3 (Audio)
    upstream homm3_audio {
        server homm3:8081;
    }

    # Upstream for junglebook
    upstream junglebook {
        server junglebook:8080;
    }

    # Upstream for lemmings
    upstream lemmings {
        server lemmings:8080;
    }

    # Upstream for lionking
    upstream lionking {
        server lionking:8080;
    }

    # Upstream for lostvikings
    upstream lostvikings {
        server lostvikings:8080;
    }

    # Upstream for mortalkombat
    upstream mortalkombat {
        server mortalkombat:8080;
    }

    # Upstream for pacman
    upstream pacman {
        server pacman:8080;
    }

    # Upstream for princeofpersia
    upstream princeofpersia {
        server princeofpersia:8080;
    }

    # Upstream for redalert
    upstream redalert {
        server redalert:8080;
    }

    # Upstream for spaceinvaders
    upstream spaceinvaders {
        server spaceinvaders:8080;
    }

    # Upstream for wolfenstein
    upstream wolfenstein {
        server wolfenstein:8080;
    }

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Performance optimizations
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_min_length 256;
    gzip_types
        application/javascript
        application/json
        application/wasm
        application/xml
        image/svg+xml
        text/css
        text/javascript
        text/plain
        text/xml;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    # Main server
    server {
        listen 80;
        server_name localhost;

        # Root location - serve index page
        location = / {
            root /etc/nginx/html/;
            index index.html;
        }

        # Player page for on-demand games
        location = /player.html {
            root /etc/nginx/html/;
        }

        # Player page for HoMM3 (Wine-based games)
        location = /player-homm3.html {
            root /etc/nginx/html/;
        }


        # Route for aladdin
        location /aladdin {
            return 302 /aladdin/;
        }

        location /aladdin/ {
            proxy_pass http://aladdin/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for chess
        location /chess {
            return 302 /chess/;
        }

        location /chess/ {
            proxy_pass http://chess/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for doom
        location /doom {
            return 302 /doom/;
        }

        location /doom/ {
            proxy_pass http://doom/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for doomii
        location /doomii {
            return 302 /doomii/;
        }

        location /doomii/ {
            proxy_pass http://doomii/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for duke3d
        location /duke3d {
            return 302 /duke3d/;
        }

        location /duke3d/ {
            proxy_pass http://duke3d/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for earthwormjim
        location /earthwormjim {
            return 302 /earthwormjim/;
        }

        location /earthwormjim/ {
            proxy_pass http://earthwormjim/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for goldenaxe
        location /goldenaxe {
            return 302 /goldenaxe/;
        }

        location /goldenaxe/ {
            proxy_pass http://goldenaxe/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for gta
        location /gta {
            return 302 /gta/;
        }

        location /gta/ {
            proxy_pass http://gta/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # VNC WebSocket route for homm3
        location /homm3-vnc/ {
            proxy_pass http://homm3_vnc/;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_read_timeout 86400;
        }

        # Audio WebSocket route for homm3
        location /homm3-audio/ {
            proxy_pass http://homm3_audio/;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_read_timeout 86400;
        }

        # Route for junglebook
        location /junglebook {
            return 302 /junglebook/;
        }

        location /junglebook/ {
            proxy_pass http://junglebook/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for lemmings
        location /lemmings {
            return 302 /lemmings/;
        }

        location /lemmings/ {
            proxy_pass http://lemmings/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for lionking
        location /lionking {
            return 302 /lionking/;
        }

        location /lionking/ {
            proxy_pass http://lionking/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for lostvikings
        location /lostvikings {
            return 302 /lostvikings/;
        }

        location /lostvikings/ {
            proxy_pass http://lostvikings/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for mortalkombat
        location /mortalkombat {
            return 302 /mortalkombat/;
        }

        location /mortalkombat/ {
            proxy_pass http://mortalkombat/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for pacman
        location /pacman {
            return 302 /pacman/;
        }

        location /pacman/ {
            proxy_pass http://pacman/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for princeofpersia
        location /princeofpersia {
            return 302 /princeofpersia/;
        }

        location /princeofpersia/ {
            proxy_pass http://princeofpersia/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for redalert
        location /redalert {
            return 302 /redalert/;
        }

        location /redalert/ {
            proxy_pass http://redalert/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for spaceinvaders
        location /spaceinvaders {
            return 302 /spaceinvaders/;
        }

        location /spaceinvaders/ {
            proxy_pass http://spaceinvaders/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Route for wolfenstein
        location /wolfenstein {
            return 302 /wolfenstein/;
        }

        location /wolfenstein/ {
            proxy_pass http://wolfenstein/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    }
}
